---
tıtle: "Ousmane_SOW et_Mamadou_Demba_BA ADM_CC2"
output: github_document
---



Article analysé :
Rauer L. et al. (2025). De-biasing microbiome sequencing data: bacterial morphology-based correction of extraction bias and correlates of chimera formation. 

Auteurs : Ousmane SOW et Mamadou Demba BA
Affiliation : Master 1 MFA, UBO Brest
Professeur  : Loïs Maignien

1_Problématique et objectif

Le séquençage du gène 16S rRNA est très utilisé pour étudier le microbiome, mais les résultats peuvent être faussés par des biais techniques, notamment lors de l’extraction de l’ADN. Ce biais d’extraction modifie les abondances relatives des bactéries et rend les comparaisons entre études difficiles. Il n’existait jusqu’à présent aucune méthode permettant de corriger ce biais dans les échantillons environnementaux.

L’objectif de cet article est d’étudier l’effet des protocoles d’extraction sur la composition du microbiome et de proposer une méthode pour corriger le biais d’extraction à partir de la morphologie des bactéries.

2_Matériel et Méthodes

Les auteurs utilisent des communautés bactériennes artificielles (mocks) dont la composition est connue, sous forme de cellules entières et d’ADN purifié. Ces échantillons sont traités avec différents protocoles d’extraction combinant plusieurs kits, conditions de lyse et buffers. Après séquençage du gène 16S rRNA, les données sont analysées avec DADA2. Le biais d’extraction est mesuré en comparant les mocks cellulaires aux mocks ADN et est relié aux caractéristiques morphologiques des bactéries.

3_Résultats principaux

La composition du microbiome différait significativement selon les kits d’extraction et les conditions de lyse, mais pas selon les tampons. Indépendamment du protocole d’extraction, la formation de chimères augmentait avec des nombres de cellules d’entrée plus élevés. Les contaminants provenaient majoritairement des tampons, et une contamination croisée importante a été observée dans les échantillons à faible quantité de matériel initial. La comparaison de la composition du microbiome des cell mocks avec celle des DNA mocks correspondants a révélé un biais d’extraction dépendant du protocole et spécifique des taxons. De manière remarquable, ce biais d’extraction, spécifique à chaque espèce, pouvait être prédit à partir de la morphologie cellulaire bactérienne. Une correction computationnelle du biais d’extraction basée sur la morphologie a significativement amélioré les compositions microbiennes obtenues lorsqu’elle était appliquée à différents échantillons mock, y compris avec des taxons différents. L’application d’une correction équivalente aux échantillons cutanés a montré un impact substantiel sur les compositions du microbiome.

4_Conclusion 

Cet article montre qu’il est possible de corriger le biais d’extraction en microbiome 16S en utilisant des caractéristiques simples des bactéries, comme la morphologie. Cette approche améliore la qualité des données et représente une avancée importante pour rendre les études de microbiome plus comparables.


Nous avons réalisé l’analyse bioinformatique des données de séquençage du gène 16S rRNA issues de l’article de Rauer et al. (2025), intitulé « De-biasing microbiome sequencing data: bacterial morphology-based correction of extraction bias and correlates of chimera formation », en utilisant le pipeline DADA2 et le package phyloseq sous R.

Cette analyse a compris le contrôle qualité des lectures de séquençage, l’inférence des variants de séquence exacts (ASV), l’assignation taxonomique, ainsi que l’analyse de la diversité microbienne à différents niveaux taxonomiques, du phylum jusqu’à l’espèce. Nous avons également réalisé la visualisation de la diversité alpha à l’aide des indices de Shannon et de Simpson en fonction des groupes d’échantillons.

5_Analyse Bioinformatique (DADA2 et Phyloseq)

La section suivante  décrit en détail les différentes étapes du traitement bioinformatique ainsi que les analyses réalisées a l'aide de DADA2 et Phyloseq.




Chargement du package DADA2 et affichage de sa version
```{r}
library(dada2); packageVersion("dada2")
```

Définition du chemin vers le répertoire contenant les fichiers FASTQ et affichage de leur liste
```{r}
path <- "~/article" # CHANGE ME to the directory containing the fastq files after unzipping.
list.files(path)
```
Identification des fichiers FASTQ forward et reverse et extraction des noms d’échantillons
Sélection des fichiers FASTQ forward (_1.fastq) et reverse (_2.fastq) et récupération des noms d’échantillons
```{r}
# Forward and reverse fastq filenames have format: SAMPLENAME_1.fastq and SAMPLENAME_2.fastq
fnFs <- sort(list.files(path, pattern="_1.fastq", full.names = TRUE))
fnRs <- sort(list.files(path, pattern="_2.fastq", full.names = TRUE))
# Extract sample names, assuming filenames have format: SAMPLENAME_XXX.fastq
sample.names <- sapply(strsplit(basename(fnFs), "_"), `[`, 1)
```


Affichage des profils de qualité des reads forward
La qualité des lectures forward est globalement élevée sur la majeure partie de la séquence, avec une diminution progressive après ~240–260 cycles.
```{r}
plotQualityProfile(fnFs[1:2])
```

Affichage des profils de qualité des reads reverse
La qualité des lectures reverse est élevée au début mais chute fortement après ~200–220 cycles
```{r}
plotQualityProfile(fnRs[1:2])
```


Définition des chemins des fichiers FASTQ filtrés (reads forward et reverse)
Création des chemins de sortie pour les fichiers FASTQ filtrés forward et reverse, associés à chaque échantillon
Préparation des fichiers FASTQ filtrés
```{r}
# Place filtered files in filtered/ subdirectory
filtFs <- file.path(path, "filtered", paste0(sample.names, "_F_filt.fastq.gz"))
filtRs <- file.path(path, "filtered", paste0(sample.names, "_R_filt.fastq.gz"))
names(filtFs) <- sample.names
names(filtRs) <- sample.names
```


Filtrage, élimination des séquences de mauvaise qualité et tronquage des reads forward et reverse selon les profils de qualité
Après le filtrage, une forte proportion de lectures est éliminée, indiquant un filtrage strict lié au tronquage et aux critères de qualité, avec une variabilité marquée entre les échantillons.
```{r}
out <- filterAndTrim(fnFs, filtFs, fnRs, filtRs, truncLen=c(280,210),
              maxN=0, maxEE=c(2,2), truncQ=2, rm.phix=TRUE,
              compress=TRUE, multithread=FALSE) # On Windows set multithread=FALSE (only needed for filterAndTrim)
head(out)
```


Apprentissage des taux d’erreur des reads forward à partir des données filtrées
Les taux d’erreur sont estimés à partir d’un grand nombre de lectures et de bases, ce qui garantit une estimation robuste et fiable du modèle d’erreur.
```{r}
errF <- learnErrors(filtFs, multithread=TRUE)
```

Apprentissage des taux d’erreur des reads reverse à partir des données filtrées
Les taux d’erreur des reads reverse sont estimés à partir d’un volume important de lectures provenant de plusieurs échantillons, assurant une estimation fiable du modèle d’erreur.
```{r}
errR <- learnErrors(filtRs, multithread=TRUE)
```


Visualisation et validation du modèle d’erreur appris pour les reads forward
Les taux d’erreur observés (points) suivent globalement les erreurs estimées par le modèle (lignes rouges), indiquant un bon apprentissage du modèle d’erreur
                                              
```{r}
plotErrors(errF, nominalQ=TRUE)
```

Visualisation et validation du modèle d’erreur appris pour les reads reverse
Les erreurs observées concordent avec les erreurs estimées par le modèle, indiquant un apprentissage correct du modèle d’erreur pour les reads reverse. 
```{r}
plotErrors(errR, nominalQ=TRUE)
```

Inférence des variants de séquence (ASVs) pour les reads forward avec DADA2
Chaque échantillon est débruité individuellement, produisant un nombre variable de séquences uniques (ASVs) en fonction de la profondeur de séquençage et de la diversité microbienne.

```{r}
dadaFs <- dada(filtFs, err=errF, multithread=TRUE)
```

Inférence des variants de séquence (ASVs) pour les reads reverse avec DADA2
Les reads reverse sont débruités par échantillon, générant un nombre variable de séquences uniques, généralement plus faible que pour les reads forward en raison d’une qualité moindre
```{r}
dadaRs <- dada(filtRs, err=errR, multithread=TRUE)
```

Affichage des résultats de débruitage DADA2 pour le premier échantillon (reads forward)
Pour l’échantillon 1 (reads forward), DADA2 a inféré 42 ASVs à partir de 3201 séquences uniques, illustrant une réduction efficace du bruit de séquençage par le modèle.

```{r}
dadaFs[[1]]
```

Affichage des résultats de débruitage DADA2 pour le premier échantillon (reads reverse)
Pour l’échantillon 1 (reads reverse), DADA2 a inféré 31 ASVs à partir de 3405 séquences uniques, montrant un débruitage efficace mais avec moins de variants que les reads forward en raison d’une qualité plus faible.
```{r}
dadaRs[[1]]
```


Fusion des reads forward et reverse appariés et inspection du résultat pour le premier échantillon
Les reads forward et reverse sont assemblés sur leur région de recouvrement, produisant des séquences complètes prêtes pour les étapes suivantes de l’analyse.
```{r}
mergers <- mergePairs(dadaFs, filtFs, dadaRs, filtRs, verbose=TRUE)
# Inspect the merger data.frame from the first sample
head(mergers[[1]])
```

Construction de la table de séquences (ASV table) à partir des reads fusionnés
La table de séquences contient 94 échantillons (lignes) et 731 variants de séquence (colonnes), représentant les ASVs détectés après fusion des reads.
```{r}
seqtab <- makeSequenceTable(mergers)
dim(seqtab)
```

Inspection de la distribution des longueurs des séquences (ASVs)
```{r}
# Inspect distribution of sequence lengths
table(nchar(getSequences(seqtab)))
```

Suppression des séquences chimériques à partir de la table d’ASVs
109 séquences chimériques ont été détectées et supprimées, laissant une table finale de 94 échantillons et 622 ASVs prête pour l’assignation taxonomique
```{r}
seqtab.nochim <- removeBimeraDenovo(seqtab, method="consensus", multithread=TRUE, verbose=TRUE)
dim(seqtab.nochim)
```


Calcul de la proportion de lectures non chimériques conservées
Environ 93,4 % des lectures sont conservées après la suppression des chimères, indiquant une bonne qualité globale des données
```{r}
sum(seqtab.nochim)/sum(seqtab)
```


Suivi du nombre de lectures à chaque étape du pipeline DADA2 pour chaque échantillon
e tableau permet de visualiser les pertes de lectures à chaque étape (filtrage, débruitage, fusion, suppression des chimères) et de contrôler la qualité du traitement par échantillon
```{r}
getN <- function(x) sum(getUniques(x))
track <- cbind(out, sapply(dadaFs, getN), sapply(dadaRs, getN), sapply(mergers, getN), rowSums(seqtab.nochim))
# If processing a single sample, remove the sapply calls: e.g. replace sapply(dadaFs, getN) with getN(dadaFs)
colnames(track) <- c("input", "filtered", "denoisedF", "denoisedR", "merged", "nonchim")
rownames(track) <- sample.names
head(track)
```

Assignation taxonomique des ASVs à l’aide de la base de données SILVA
Les ASVs non chimériques sont assignés taxonomiquement (jusqu’au genre) en utilisant la base de données SILVA v138.2
```{r}
taxa <- assignTaxonomy(seqtab.nochim, "~/article/silva_nr99_v138.2_toGenus_trainset.fa.gz?download=1", multithread=TRUE)
```


Affinement de l’assignation taxonomique au niveau espèce à l’aide de la base de données SILVA
Cette étape tente d’assigner un nom d’espèce aux ASVs déjà classés, lorsque l’information de la base SILVA v138.2 le permet
```{r}
taxa <- addSpecies(taxa, "~/article/silva_v138.2_assignSpecies.fa.gz?download=1")
```


Préparation et affichage de la table d’assignation taxonomique des ASVs
La table affiche l’assignation taxonomique des ASVs du phylum à l’espèce, avec certaines espèces non résolues (NA)

```{r}
taxa.print <- taxa # Removing sequence rownames for display only
rownames(taxa.print) <- NULL
head(taxa.print)
```


Chargement du package DECIPHER et vérification de sa version
```{r}
library(DECIPHER); packageVersion("DECIPHER")
```

Assignation taxonomique des ASVs avec DECIPHER (IdTaxa) à l’aide de la base SILVA et conversion des résultats en matrice taxonomique
```{r}
dna <- DNAStringSet(getSequences(seqtab.nochim)) # Create a DNAStringSet from the ASVs
load("~/article/SILVA_SSU_r138_2_2024.RData") # CHANGE TO THE PATH OF YOUR TRAINING SET
ids <- IdTaxa(dna, trainingSet, strand="top", processors=NULL, verbose=FALSE) # use all processors
ranks <- c("domain", "phylum", "class", "order", "family", "genus", "species") # ranks of interest
# Convert the output object of class "Taxa" to a matrix analogous to the output from assignTaxonomy
taxid <- t(sapply(ids, function(x) {
        m <- match(ranks, x$rank)
        taxa <- x$taxon[m]
        taxa[startsWith(taxa, "unclassified_")] <- NA
        taxa
}))
colnames(taxid) <- ranks; rownames(taxid) <- getSequences(seqtab.nochim)
```



Importation des métadonnées des échantillons
La première colonne correspond aux identifiants des échantillons (SampleID)
Ces identifiants seront utilisés pour faire la correspondance avec la table ASV
Vérification du bon chargement des métadonnées avant intégration dans phyloseq
```{r}
metadata <- read.csv(
  "/home/rstudio/article/metadonees.csv",
  header = TRUE,
  row.names = 1,
  sep = ","
)


```


Aperçu des premières lignes des métadonnées
Vérification de la structure et des variables associées aux échantillons
Contrôle de la cohérence des informations avant l'intégration dans phyloseq
Affichage des identifiants des échantillons
Vérification que les noms de lignes correspondent aux IDs de séquençage (SRA/ENA)
```{r}
head(metadata)
rownames(metadata)
```


Vérification des identifiants des échantillons dans la table ASV (après suppression des chimères)
Les noms de lignes correspondent aux SampleID et doivent correspondre aux métadonnées
Contrôle de la cohérence avant la création de l'objet phyloseq
Vérification des séquences ASV
Les noms de colonnes correspondent aux séquences nucléotidiques uniques (ASV)
Chaque colonne représente une ASV issue de DADA2

```{r}
head(rownames(seqtab.nochim))
head(colnames(seqtab.nochim))
```


Vérification de la correspondance entre les échantillons de la table ASV et les métadonnées
Contrôle que tous les identifiants d'échantillons présents dans seqtab.nochim
sont bien retrouvés dans les métadonnées
Cette étape est indispensable avant la création de l'objet phyloseq

Le résultat TRUE confirme que : tous les SampleID de la table ASV sont présents dans metadata
l’intégration dans phyloseq peut se faire sans erreur

```{r}
all(rownames(seqtab.nochim) %in% rownames(metadata))
```


Réordonnancement des métadonnées selon l'ordre des échantillons de la table ASV
Alignement strict entre les SampleID de seqtab.nochim et ceux des métadonnées
Prévention des erreurs d'association lors de la création de l'objet phyloseq
Conservation du format data.frame même en cas de sélection d'une seule colonne
Cette étape garantit que : l’ordre des échantillons est identique dans seqtab.nochim et metadata

```{r}
metadata <- metadata[rownames(seqtab.nochim), , drop = FALSE]
```

Chargement du package phyloseq pour l'analyse des données de microbiome
Vérification de la version utilisée afin d'assurer la reproductibilité des analyses

```{r}
library(phyloseq); packageVersion("phyloseq")
```

Chargement du package Biostrings et vérification de sa version

```{r}
library(Biostrings); packageVersion("Biostrings")
```

Chargement du package ggplot2 et vérification de sa version
```{r}
library(ggplot2); packageVersion("ggplot2")
```

Définition du thème graphique par défaut (theme_bw) pour les visualisations ggplot2
```{r}
theme_set(theme_bw())
```


Création de l’objet phyloseq à partir des tables d’ASVs, de taxonomie et de métadonnées, puis suppression de l’échantillon mock
```{r}
ps <- phyloseq(otu_table(seqtab.nochim, taxa_are_rows=FALSE),
               sample_data(metadata),
               tax_table(taxa))
ps <- prune_samples(sample_names(ps) != "Mock", ps) # Remove mock sample
```


Ajout des séquences de référence (ASVs) à l’objet phyloseq et renommage standardisé des ASVs
L’objet phyloseq final regroupe 94 échantillons et 622 ASVs, avec leurs abondances, taxonomie (7 rangs), séquences ADN et 49 variables de métadonnées
```{r}
dna <- Biostrings::DNAStringSet(taxa_names(ps))
names(dna) <- taxa_names(ps)
ps <- merge_phyloseq(ps, dna)
taxa_names(ps) <- paste0("ASV", seq(ntaxa(ps)))
ps
```

Visualisation de la diversité alpha (indices de Shannon et Simpson) selon les groupes d’échantillons

Les indices Shannon et Simpson montrent une diversité alpha globalement élevée et comparable entre la majorité des groupes, avec un groupe (SAMEA17585918) nettement moins diversifié, suggérant une communauté microbienne plus pauvre ou dominée

```{r}
metadata$Group <- metadata$BioSample
sample_data(ps) <- sample_data(metadata)
```

```{r}
p <- plot_richness(ps, x="Group", measures=c("Shannon","Simpson"), color="BioSample")
p + theme(legend.position = "none")
```




Normalisation des abondances en proportions relatives par échantillon
```{r}
ps.prop <- transform_sample_counts(ps, function(x) x / sum(x))

```

Vérification de l’absence de valeurs manquantes (NA) dans la table d’abondances normalisées
Aucune valeur NA n’est présente après la normalisation, indiquant une transformation correcte des données
FALSE signifie qu’il n’y a aucune valeur manquante (NA) dans la table d’abondances normalisées
```{r}
any(is.na(otu_table(ps.prop)))
```
Suppression des échantillons sans lectures (abondance totale égale à zéro)
```{r}
ps <- prune_samples(sample_sums(ps) > 0, ps)
```

Filtrage des échantillons ayant au moins 1000 lectures pour garantir une profondeur suffisante
Cette étape élimine les échantillons à faible profondeur de séquençage, afin d’améliorer la robustesse des analyses de diversité
```{r}
ps <- prune_samples(sample_sums(ps) >= 1000, ps)
```

Normalisation des abondances en proportions relatives par échantillon
```{r}
ps.prop <- transform_sample_counts(ps, function(x) x / sum(x))
```


Ordination NMDS basée sur la distance de Bray-Curtis à partir des abondances relatives
L’ordination NMDS montre une excellente représentation des dissimilarités entre échantillons (stress ≈ 0), indiquant une structure très robuste des communautés microbiennes selon la distance de Bray-Curtis
```{r}
# Transform data to proportions as appropriate for Bray-Curtis distances
ps.prop <- transform_sample_counts(ps, function(otu) otu/sum(otu))
ord.nmds.bray <- ordinate(ps.prop, method="NMDS", distance="bray")
```


Visualisation de l’ordination NMDS basée sur la distance de Bray-Curtis
Le graphique NMDS (Bray-Curtis) montre une séparation nette entre certains échantillons, indiquant des différences marquées de composition microbienne, avec un échantillon (SAMEA117585918) clairement isolé, suggérant une communauté distincte
```{r}
p <- plot_ordination(ps.prop, ord.nmds.bray, color="BioSample") +
  geom_point(size=3, alpha=0.8) +
  ggtitle("Bray NMDS")

p

```

Vérification du nombre d’échantillons et de la profondeur de séquençage, et détection d’éventuels échantillons sans lectures

L’objet phyloseq contient 6 échantillons, avec une profondeur de séquençage comprise entre 1155 et 2918 reads, et aucun échantillon à 0 lecture, aussi bien pour les comptes bruts (ps) que pour les abondances relatives (ps.prop), confirmant un jeu de données propre et exploitable.
```{r}
nsamples(ps)
summary(sample_sums(ps))

# combien ont 0 reads ?
sum(sample_sums(ps) == 0)

# si tu travailles avec ps.prop :
nsamples(ps.prop)
sum(sample_sums(ps.prop) == 0)
```


 Affichage des variables de métadonnées associées aux échantillons dans l’objet phyloseq
 Ces commandes permettent de lister les colonnes de métadonnées disponibles pour les analyses statistiques et graphiques.
```{r}
sample_variables(ps)
# ou
colnames(as.data.frame(sample_data(ps)))
```

Sélection des 20 taxons les plus abondants et visualisation de leur abondance relative par phylum
Le graphique montre une forte dominance du phylum Pseudomonadota dans tous les échantillons, tandis que Chloroflexota est présent à faible abondance et seulement dans certains échantillons, indiquant une composition microbienne globalement peu diversifiée au niveau des phylums
```{r}
top20 <- names(sort(taxa_sums(ps), decreasing=TRUE))[1:20]
ps.top20 <- transform_sample_counts(ps, function(OTU) OTU/sum(OTU))
ps.top20 <- prune_taxa(top20, ps.top20)

plot_bar(ps.top20, x = "BioSample", fill = "Phylum") +
  theme_classic() +
  scale_fill_brewer(palette = "Set3") +
  labs(
    x = "Échantillons",
    y = "Abondance relative (%)",
    fill = "Phylum",
    title = "Top 20 des Phylums bactériennes"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "right"
  )

```

Sélection des 20 taxons les plus abondants et visualisation de leur abondance relative au niveau classe
Le graphique met en évidence une forte dominance de la classe Alphaproteobacteria dans tous les échantillons, tandis que Chloroflexia est faiblement représentée et ponctuelle.
```{r}
top20 <- names(sort(taxa_sums(ps), decreasing=TRUE))[1:20]
ps.top20 <- transform_sample_counts(ps, function(OTU) OTU/sum(OTU))
ps.top20 <- prune_taxa(top20, ps.top20)
 
plot_bar(ps.top20, x = "BioSample", fill = "Class") +
  theme_classic() +
  scale_fill_brewer(palette = "Set3") +
  labs(
    x = "Échantillons",
    y = "Abondance relative (%)",
    fill = "Classes",
    title = "Top 20 des Classes bactériennes"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "right"
  )

```


Sélection des 20 taxons les plus abondants et visualisation de leur abondance relative au niveau ordre
Le graphique montre une forte dominance de l’ordre Rhodobacterales dans l’ensemble des échantillons, particulièrement marquée pour SAMEA117585918, tandis que les autres ordres (Hyphomicrobiales, Caulobacterales, Azospirillales, etc.) sont présents à des abondances plus faibles, révélant une structure communautaire déséquilibrée et dominée par quelques ordres.
```{r}
top20 <- names(sort(taxa_sums(ps), decreasing=TRUE))[1:20]
ps.top20 <- transform_sample_counts(ps, function(OTU) OTU/sum(OTU))
ps.top20 <- prune_taxa(top20, ps.top20)
plot_bar(ps.top20, x = "BioSample", fill = "Order") +
  theme_classic() +
  scale_fill_brewer(palette = "Set3") +
  labs(
    x = "Échantillons",
    y = "Abondance relative (%)",
    fill = "Ordres",
    title = "Top 20 des Ordres bactériennes"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "right"
  )
```



Sélection des 20 taxons les plus abondants et visualisation de leur abondance relative au niveau famille.
Le graphique montre une dominance marquée de la famille Paracoccaceae dans l’ensemble des échantillons, particulièrement pour SAMEA117585918, tandis que les autres familles (Caulobacteraceae, Rhizobiaceae, Acetobacteraceae, etc.) sont présentes à des abondances plus faibles.

```{r}
top20 <- names(sort(taxa_sums(ps), decreasing=TRUE))[1:20]
ps.top20 <- transform_sample_counts(ps, function(OTU) OTU/sum(OTU))
ps.top20 <- prune_taxa(top20, ps.top20)
plot_bar(ps.top20, x = "BioSample", fill = "Family") +
  theme_classic() +
  scale_fill_brewer(palette = "Set3") +
  labs(
    x = "Échantillons",
    y = "Abondance relative (%)",
    fill = "Familles",
    title = "Top 20 des Familles bactériennes"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "right"
  )
```

Sélection des 20 genres bactériens les plus abondants et visualisation de leur abondance relative par échantillon
Le graphique montre une forte dominance du genre Paracoccus dans tous les échantillons, particulièrement marquée pour SAMEA117585918, tandis que les autres genres (Agrobacterium, Brevundimonas, Skermanella, etc.) sont présents à des abondances plus faibles, indiquant une communauté microbienne dominée par un nombre limité de genres, avec quelques taxons non assignés (NA) niveau genre

```{r}
top20 <- names(sort(taxa_sums(ps), decreasing=TRUE))[1:20]
ps.top20 <- transform_sample_counts(ps, function(OTU) OTU/sum(OTU))
ps.top20 <- prune_taxa(top20, ps.top20)
plot_bar(ps.top20, x = "BioSample", fill = "Genus") +
  theme_classic() +
  scale_fill_brewer(palette = "Set3") +
  labs(
    x = "Échantillons",
    y = "Abondance relative (%)",
    fill = "Genres",
    title = "Top 20 des Genres bactériennes"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "right"
  )
```


Analyse de la composition microbienne au niveau espèce :
affichage des 20 espèces les plus abondantes en abondance relative
Au rang espèce, la majorité des ASV ne peuvent pas être assignées de manière fiable. Les espèces identifiées représentent donc une fraction limitée mais dominante de la communauté.
L’analyse au rang espèce révèle une dominance apparente de quelques taxons, toutefois la majorité des ASV ne sont pas assignées de manière fiable à ce niveau. Conformément aux limites inhérentes au marqueur 16S rRNA, l’interprétation écologique est principalement basée sur les niveaux taxonomiques supérieurs 
On voit cas meme une dominance de l’espèce solventivorans dans l’échantillon SAMEA117585918.

```{r}
top20 <- names(sort(taxa_sums(ps), decreasing=TRUE))[1:20]
ps.top20 <- transform_sample_counts(ps, function(OTU) OTU/sum(OTU))
ps.top20 <- prune_taxa(top20, ps.top20)
plot_bar(ps.top20, x = "BioSample", fill = "Species") +
  theme_classic() +
  scale_fill_brewer(palette = "Set3") +
  labs(
    x = "Échantillons",
    y = "Abondance relative (%)",
    fill = "Especes",
    title = "Top 20 des Especes bactériennes"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "right"
  )
```

Visualisation de la composition taxonomique au niveau famille :
top 20 des familles bactériennes en abondance relative par milieu environnemental
La composition bactérienne varie fortement selon le milieu environnemental : la peau humaine présente une communauté plus diversifiée avec plusieurs familles co-dominantes, tandis que l’environnement de laboratoire est caractérisé par une forte dominance de quelques familles, reflétant une structure microbienne plus simplifiée et sélective.

```{r}
top20 <- names(sort(taxa_sums(ps), decreasing=TRUE))[1:20]
ps.top20 <- transform_sample_counts(ps, function(OTU) OTU/sum(OTU))
ps.top20 <- prune_taxa(top20, ps.top20)

plot_bar(ps.top20, x = "environmental_medium", fill = "Family") +
  theme_classic() +
  scale_fill_brewer(palette = "Set3") +
  labs(
    x = "milieu environnemental",
    y = "Abondance relative (%)",
    fill = "Familles",
    title = "Top 20 des Familles bactériennes"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "right"
  )
```









